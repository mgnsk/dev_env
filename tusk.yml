tasks:
  build:
    options:
      dot_url:
        default: https://github.com/mgnsk/dotfiles.git
      dot_commit:
        default: 2714d255c5e5ccb45d0a6eca417995999f4b425a
    run:
    - command: >
        docker
        build
        --pull
        --build-arg dot_url=${dot_url}
        --build-arg dot_commit=${dot_commit}
        -t mgnsk/dev-env:latest
        ./image
    - command: docker image prune -f

  bash:
    usage: Run a bash shell as user.
    description: The user is created and permissions set on entry.
    options:
      uid:
        default: 5000
      user:
        default: devuser
      gid:
        default: 6000
      group:
        default: devgroup
    run:
    - command: >
        docker-compose run
        --rm
        --service-ports
        --entrypoint /asuser.sh
        -e UID=${uid}
        -e USER=${user}
        -e GID=${gid}
        -e GROUP=${group}
        dev-env
        /bin/bash

  logs:
    run:
    - command: docker-compose logs -f -t --tail="all"

